#ifdef __cplusplus
extern "C" {
#endif

#ifndef JSBUFFER_C_JSB_H
#define JSBUFFER_C_JSB_H

#cmakedefine JSB_SERIALIZER_USE_MALLOC
#cmakedefine JSB_SCHEMA_USE_MALLOC
#cmakedefine HAVE_SIZE_TYPE
#cmakedefine HAVE_UINT64_TYPE
#cmakedefine HAVE_VOID_TYPE
#cmakedefine HAVE_UINT32_TYPE
#cmakedefine HAVE_UINT16_TYPE
#cmakedefine HAVE_UINT8_TYPE
#cmakedefine HAVE_INT64_TYPE
#cmakedefine HAVE_INT32_TYPE
#cmakedefine HAVE_INT16_TYPE
#cmakedefine HAVE_INT8_TYPE
#cmakedefine HAVE_FLOAT_TYPE
#cmakedefine HAVE_DOUBLE_TYPE
#cmakedefine HEADER_FOUND_STDINT_H
#cmakedefine HEADER_FOUND_STDDEF_H
#cmakedefine HEADER_FOUND_STRING_H
#cmakedefine HEADER_FOUND_STDIO_H
#cmakedefine HEADER_FOUND_INTTYPES_H
#cmakedefine HEADER_FOUND_SYS_TYPEYPES_H
#cmakedefine JSB_MAX_STRING_SIZE @JSB_MAX_STRING_SIZE@
#cmakedefine JSB_ENABLE_TRACE

#if defined(JSB_ENABLE_TRACE) && !defined(HEADER_FOUND_STDIO_H)
#warning "stdio.h not found, cannot enable trace"
#undef JSB_ENABLE_TRACE
#endif

#ifdef JSB_ENABLE_TRACE
#define JSB_TRACE(tag, ...) do { \
    printf("%s:%d: %s: ", __FILE__, __LINE__, tag); \
    printf(__VA_ARGS__); \
} while (0)
#else
#define JSB_TRACE(...)
#endif // JSB_ENABLE_TRACE

// Standard C library functions
#cmakedefine HAVE_STRLEN
#cmakedefine HAVE_MEMCPY
#cmakedefine HAVE_MEMSET

#if defined(HEADER_FOUND_STDDEF_H)
#include <stddef.h>
#endif

#if defined(HEADER_FOUND_STDINT_H)
#include <stdint.h>
#elif defined(HEADER_FOUND_INTTYPES_H)
#include <inttypes.h>
#elif defined(HEADER_FOUND_SYS_TYPES_H)
#include <sys/types.h>
#else
#error "No suitable header found for standard integer types"
#endif

enum jsb_result_t {
  JSB_OK = 0,
  // Out of bounds error
  JSB_OUT_OF_BOUNDS = 1,
  JSB_MEMORY_ALLOCATION_ERROR = 2,
  // Buffer is too small to hold the data
  JSB_BUFFER_OVERFLOW = 3,
  JSB_INVALID_CRC_HEADER = 4,
  JSB_INVALID_DECODED_VALUE = 5,
  JSB_BAD_ARGUMENT = 6,
  JSB_NOT_SUPPORTED = 7
};

/**
 * Check if the expression results in an error and return it if it is.
 */
#define JSB_CHECK_ERROR(expr) do { \
    enum jsb_result_t __result__ = (expr); \
    if (__result__ != JSB_OK) { \
        return __result__; \
    } \
} while (0)

#ifdef HAVE_UINT8_TYPE
typedef uint8_t jsb_uint8_t;
typedef jsb_uint8_t jsb_byte_t;
typedef jsb_byte_t jsb_bytes_t[JSB_MAX_STRING_SIZE + 1];
typedef jsb_uint8_t jsb_string_t[JSB_MAX_STRING_SIZE + 1];
#endif

#ifdef HAVE_INT64_TYPE
typedef int64_t jsb_int64_t;
#endif

#ifdef HAVE_UINT64_TYPE
typedef uint64_t jsb_uint64_t;
#endif

#ifdef HAVE_INT32_TYPE
typedef int32_t jsb_int32_t;
#endif

#ifdef HAVE_FLOAT_TYPE
typedef float jsb_float_t;
#endif

#ifdef HAVE_DOUBLE_TYPE
typedef double jsb_double_t;
#endif

#ifdef HAVE_UINT32_TYPE
typedef uint32_t jsb_uint32_t;
#else
typedef unsigned int jsb_uint32_t;
#endif

#ifdef HAVE_UINT16_TYPE
typedef uint16_t jsb_uint16_t;
#endif

#ifdef HAVE_INT16_TYPE
typedef int16_t jsb_int16_t;
#endif

#ifdef HAVE_INT8_TYPE
typedef int8_t jsb_int8_t;
#endif

#ifdef HAVE_SIZE_TYPE
typedef size_t jsb_size_t;
#endif

#ifdef HAVE_VOID_TYPE
typedef void jsb_void_t;
#endif

jsb_uint32_t jsb_strlen(const jsb_string_t str);
void* jsb_memcpy(void* dest, const void* src, jsb_uint32_t len);

#endif // JSBUFFER_C_JSB_H

#ifdef __cplusplus
}
#endif